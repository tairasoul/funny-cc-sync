local a,b=...local c=a.."/channels"if b then c=c.."/"..b end;local function d(e,f)local g={}for h in string.gmatch(e,"([^"..f.."]+)")do table.insert(g,h)end;return g end;if not b then print("Sending channel request to http://"..c)local i=http.get("http://"..c)print(i)print(i.getResponseCode())local j=i.readAll()local k=d(j,",")local l="Available channels:"for m,n in next,k do l=l.." "..n end;print(l)return end;print("Connecting to websocket")local o=http.websocket("ws://"..c)local function p(q,j)local r=d(q,"/")local s=r[1]print(#r)if not fs.exists(s)then if#r==1 then local t=fs.open(s,"w")t.write(j)t.close()else fs.makeDir(s)end end;for u=2,#s-1 do s=s.."/"..r[u]if not fs.exists(s)then fs.makeDir(s)end end;s=s.."/"..r[#r]print(s)print(r[#r])local v=fs.open(s,"w")v.write(j)v.close()end;local function w(q)local q=d(q,"/")if#q==1 then return end;local x=q[1]local function y(z)print("checking folder "..z)local A=fs.list(z)if#A==0 then print(z.." is empty, deleting")fs.delete(z)return end;print(z.." is not empty, checking children")for m,n in next,A do if fs.isDir(n)then y(z.."/"..n)end end end;y(x)end;while true do os.sleep(0)print("attempting to receive")local B=o.receive()if B then print(B)local C=textutils.unserialiseJSON(B)if C.event=="change"then local D=C.filePath;local E=C.data;p(D,E)elseif C.event=="remove"then if fs.exists(C.filePath)then fs.delete(C.filePath)w(C.filePath)end elseif C.event=="bulk"then for m,n in next,C.data do local D=n.filePath;local E=n.data;p(D,E)end end end end